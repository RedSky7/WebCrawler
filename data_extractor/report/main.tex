\documentclass[9pt]{IEEEtran}

\usepackage[english]{babel}
\usepackage{graphicx}
\usepackage{epstopdf}
\usepackage{fancyhdr}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{url}
\usepackage{array}
\usepackage{textcomp}
\usepackage{listings}
\usepackage{hyperref}
\usepackage{xcolor}
\usepackage{colortbl}
\usepackage{float}
\usepackage{gensymb}
\usepackage{longtable}
\usepackage{supertabular}
\usepackage{multicol}
\usepackage{tabu}
\usepackage{verbatim}

\usepackage[utf8x]{inputenc}

\usepackage[T1]{fontenc}
\usepackage{lmodern}
\input{glyphtounicode}
\pdfgentounicode=1


\DeclareGraphicsExtensions{.pdf,.png,.jpg,.eps}

% correct bad hyphenation here
\hyphenation{op-tical net-works semi-conduc-tor trig-gs}

% ============================================================================================

\title{\vspace{0ex}
Data Extractor}

\author{Timotej Kovaƒç\vspace{-4.0ex}}

% ============================================================================================

\begin{document}

\maketitle

\section{Introduction}

TODO

\section{Selection of optional web pages}

For our first website we have chosen a detailed description page of a product available on web store Mimovrste~\ref{mimovrste}.
Here we have chosen some interesting fields that we might be useful as shown in figure ~\ref{fig_mimovrste}.
These were:
\begin{itemize}
\item{tags*, which further describe the item as having a discount, being a recommended product, etc.";}
\item{title;}
\item{description;}
\item{old price*, which states the price before the now discounted price;}
\item{price, which states the current price;}
\item{savings*, which represents the percentage saved;}
\item{availability, which states when the product will be available for shipment.}
\end{itemize}
Fields above marked with an asterisk don't appear always and are therefore optional.

\begin{figure}[ht]
    \centering
    \includegraphics[width=1\columnwidth]{mimovrste.png}
    \caption{Web store mimovrste.si with tagged fields that we used for extraction of web content.}
    \label{fig_mimovrste}
\end{figure}

For our second website we have chosen a page containing multiple items in a grid pattern on a web site Ceneje~\ref{ceneje}.
Here we have chosen the fields listed bellow:
\begin{itemize}
\item{image;}
\item{title;}
\item{min price, which states the minimal price in all of the stores that provide the product;}
\item{number of stores, which states the number of stores that provide the product;}
\item{action, which states what the button does either takes the user to a particular web store or to a list of webstores still on the same ceneje.si domain.}
\end{itemize}
Here none of the fields are optional but some do vary as they may contain some other words in front of the fields or are ads which have a slightly different structure.
This too can be seen in figure~\ref{fig_ceneje}.

\begin{figure}[ht]
    \centering
    \includegraphics[width=1\columnwidth]{ceneje.png}
    \caption{Web site ceneje.si with tagged fields that we used for extraction of web content.}
    \label{fig_ceneje}
\end{figure}

\section{Regular Expressions Implementation}

Bellow is the list of all regular expressions that were used on the target web pages.

\subsection{rtvslo.si}
\verb{
	Title: 				<h1>(.*?)</h1>
	SubTitle:			<div class=\"subtitle\">(.*?)</div>
	Lead:				<p class=\"lead\">(.*?)</p>
	Content:			<div class=\"article-body\">(.*?)</div>[ ]*<div class=\"article-column\">
	Author: 			<div class=\"author-name\">(.*?)</div>
	PublishedTime:		<div class=\"publish-meta\">(.*?)<br>
}

\subsection{overstock.com}
\verb{
	Title(s):			<td valign=\"top\">\W*<a.*?PROD_ID=([0-9]+)\".*?<b>(.*?)</b></a>
	Content(s):			<td valign=\"top\">\W*<a.*?PROD_ID=([0-9]+)\".*?<span class=\"normal\">(.*?)<br>	
	ListPrice(s):		<td valign=\"top\">\W*<a.*?PROD_ID=([0-9]+)\".*?<s>(.*?)</s>
	Price(s):			<td valign=\"top\">\W*<a.*?PROD_ID=([0-9]+)\".*?<span class=\"bigred\"><b>(.*?)</b>
	Saving(s):
	SavingPercent(s):	<td valign=\"top\">\W*<a.*?PROD_ID=([0-9]+)\".*?<span class=\"littleorange\">(.*?) \(([0-9]{0,2}%)\)</span>		
}

\subsection{mimovrste.si}
\verb{
	Title:				<h3.*?>(.*?)</h3>
	Description:		<p.*?itemprop=\"description\".*?>(.*?)<a
	OldPrice:			<del.*?class=\"rrp-price\".*?>(.*?)</del>
	Price:				<b class=\"pro-price.*?>(.*?)</b>
	Availability:		<a data-sel=\"availability-detail\".*?>(.*?)</a>
	Tags:				<em class=\"label.*?>(.*?)</em>
	Savings:			<div class=\"label--round-sale.*?>(.*?)</div>
}

\subsection{ceneje.si}
\verb{
	Image(s):			<div class=\"innerProductBox\">.*?<img.*?alt=\"(.*?)\".*?src=\"(.*?)\"
	Titles(s):			<div class=\"innerProductBox\">.*?<img.*?alt=\"(.*?)\".*?<h3>\W*<.*?>(.*?)</.*?>
	MinPrice(s):		<div class=\"innerProductBox\">.*?<img.*?alt=\"(.*?)\".*?<b>(.*?)</b>
	Store(s):			<div class=\"innerProductBox\">.*?<img.*?alt=\"(.*?)\".*?class=\"qtySellers\">\W*<b>(.*?)</b>
	Action(s):			<div class=\"innerProductBox\">.*?<img.*?alt=\"(.*?)\".*?<div class=\"rBox\">\W*<.*?>(.*?)</.*?>
}

\section{XPath Implementation}

Bellow are the lists of XPath expressions for every of the targeted pages.


\subsection{rtvslo.si}
\verb{
	Title:				//*[@id=\"main-container\"]/div[3]/div/header/h1/text()
	SubTitle:			//*[@id=\"main-container\"]/div[3]/div/header/div[2]/text()
	Lead:				//*[@id=\"main-container\"]/div[3]/div/header/p/text()
	Content:			string(//*[@id=\"main-container\"]/div[3]/div/div[2])
	Author:				//*[@id=\"main-container\"]/div[3]/div/div[1]/div[1]/div/text()
	PublishedTime:		//*[@id=\"main-container\"]/div[3]/div/div[1]/div[2]/text()[1]
}

%TODO: FIND IF THIS CAN BE SIMPLIFIED!
\subsection{overstock.si}
\verb{
	Title(s): 			/html/body/table[2]/tbody/tr[1]/td[5]/table/tbody/tr[2]/td/table/tbody/tr/td/table/tbody/tr[" + str(i) + "]/td[2]/a/b/text()
	Content(s):			/html/body/table[2]/tbody/tr[1]/td[5]/table/tbody/tr[2]/td/table/tbody/tr/td/table/tbody/tr[" + str(i) + "]/td[2]/table/tbody/tr/td[2]/span/text()
	ListPrice(s):		/html/body/table[2]/tbody/tr[1]/td[5]/table/tbody/tr[2]/td/table/tbody/tr/td/table/tbody/tr[" + str(i) + "]/td[2]/table/tbody/tr/td[1]/table/tbody/tr[1]/td[2]/s/text()
	Price(s):			/html/body/table[2]/tbody/tr[1]/td[5]/table/tbody/tr[2]/td/table/tbody/tr/td/table/tbody/tr[" + str(i) + "]/td[2]/table/tbody/tr/td[1]/table/tbody/tr[2]/td[2]/span/b/text()
	Saving(s):			
	SavingPercent(s):	/html/body/table[2]/tbody/tr[1]/td[5]/table/tbody/tr[2]/td/table/tbody/tr/td/table/tbody/tr[" + str(i) + "]/td[2]/table/tbody/tr/td[1]/table/tbody/tr[3]/td[2]/span/text()
}

%TODO: FIX TAGS BELLOW!
\subsection{mimovrste.si}
\verb{
	Title:				//*[@id=\"content\"]/div/article/div[1]/section[2]/h3/text()
	Description:		//*[@id=\"content\"]/div/article/div[1]/section[2]/p[2]/text()
	OldPrice:			//*[@id=\"content\"]/div/article/div[1]/section[2]/div[3]/div[1]/div[1]/div/del/text()
	Price:				//*[@class=\"price-wrapper\"]/div[1]/div[1]/b/text()
	Availability:		//*[@class=\"delivery-wrapper\"]/a/text()
	Tags:
	Savings:			//*[@id=\"content\"]/div/article/div[1]/section[2]/div[3]/div[1]/div[2]/text()
}

\subsection{ceneje.si}
\verb{
	Image(s):			//*[@id=\"productGrid\"]/div[" + str(i) + "]/div/div[1]/a/img/@src
	Title(s):			//*[@id=\"productGrid\"]/div[" + str(i) + "]/div/div[2]/h3/a/text()
	MinPrice(s):		//*[@id=\"productGrid\"]/div[" + str(i) + "]/div/div[2]/p/a[1]/b/text()
	Store(s):			//*[@id=\"productGrid\"]/div[" + str(i) + "]/div/div[2]/p/a[2]/b/text()
	Action(s):			//*[@id=\"productGrid\"]/div[" + str(i) + "]/div/div[3]/a/text()
}

\section{Automatic Web Extraction Implementation}

\subsection{Pseuocode}

\verb{
	for child in tree1:

        # Check if there is any node on count position in tree2
        if count >= len(node_2.getchildren()):
            wrapper += "(<" + str(child.tag).upper() + "... >)?"
            continue

        target = node_2.getchildren()[count]

        # Handle tag mismatches
        if mismatch(child, target):
            if contains(node_2, count, child):
                wrapper += "(<" + target.tag.upper() + "... >)?"
                count += 1
                target = node_2.getchildren()[count]
            else:
                wrapper += "(<" + str(child.tag).upper() + "... >)?"
                continue
        # Add starting tag
        new_tag = "<" + str(child.tag).upper() + ">"

        # Add text inside of the tag
        if child.text is not None:
            new_tag += get_smt(child.text, target.text)

        # Handle children of this node
        new_tag += auto_ex(child, target)

        # Add a closing tag
        new_tag += "</" + str(child.tag).upper() + ">"

        # Handle text after the current node
        if child.tail is not None:
            tail = child.tail
            if len(tail) > 0:
                new_tag += get_smt(tail, target.tail)

        # Replace multiple occurrences with a special tag
        if new_tag == prev_tag:
            wrapper = re.sub(new_tag + "$", "(" + new_tag + ")+", wrapper)
            continue

        wrapper += new_tag

        prev_tag = new_tag
        count += 1

        # If this is the last node in tree1 but there are still nodes in tree2 this one must be optional
        if node_exists(tree2, level, count):
            wrapper += "(<" + node_that_exists_in_tree2 + "... >)?"

    return wrapper
}
\subsection{Results}

\section{Conclusion}

~\cite{jauntium, robots_txt, postgres}
TODO

\bibliographystyle{IEEEtran}
\bibliography{main}

\end{document}
